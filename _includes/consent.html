{% if site.consent%}
<amp-consent layout="nodisplay" id="siteConsent">
  <script type="application/json">
    {
      "consentInstanceId": "consent1",
      "consentRequired": true,
      "promptUI": "consentPopup",
      "postPromptUI": "repromptDialog",
      "uiConfig": {
        "overlay": false
      },
      "purposeConsentRequired": [
        "marketing"
      ]
    }
  </script>
  <div id="consentPopup">
    <div id="consentDialog">
      <h4 class="color-secondary">üç™ Cookie-Einstellungen</h4>
      <p>Diese Website verwendet Cookies, die die Funktion der Website unterst√ºtzen und nachvollziehen, wie Du mit ihr
        interagierst. Wir verwenden die Cookies nur, wenn Du dem zustimmst, indem Du auf ‚ÄúAkzeptieren‚Äù
        klickst. Du kannst auch individuelle Cookie-Pr√§ferenzen unter ‚ÄúKonfigurieren‚Äù verwalten.</p>

      <hr>

      <details class="choices">
        <summary class="heading">Konfigurieren</summary>
        <label class="consentLabel" for="consent-essential">
          <input
            disabled
            checked
            id="consent-essential"
            type="checkbox"
            on="change:siteConsent.setPurpose(essential=event.checked)"
          />
          <div class="checkmark"></div>
          <div>
            <h5>Essenzielle Cookies</h5>
            Diese Cookies sind notwendig. Es handelt sich um grundlegende Cookies, um Dir eine sichere und funktionale
            Nutzung von WechselGott zu erm√∂glichen. Diese k√∂nnen daher nicht deaktiviert werden.
          </div>
        </label>
        <label class="consentLabel" for="consent-marketing">
          <input
            id="consent-marketing"
            type="checkbox"
            on="change:siteConsent.setPurpose(marketing=event.checked)"
          />
          <div class="checkmark"></div>
          <div>
            <h5>Tracking & Marketing</h5>
            Diese Cookies helfen uns zu verstehen, wie Besucher unsere Website nutzen oder wie effektiv unsere
            Marketingkampagnen sind. Sie helfen uns dabei unsere Inhalte optimal anzupassen, um Deine Nutzererfahrung zu
            verbessern.
          </div>
        </label>
      </details>
      <hr>

      <button
        class="choiceButton"
        on="tap:siteConsent.accept(purposeConsentDefault=true)"
        id="consent-all"
      >
        Akzeptieren
      </button>
      <button
        class="choiceButton stroke"
        on="tap:siteConsent.accept"
        id="consent-selected"
      >
        Auswahl erlauben
      </button>
    </div>
  </div>
  <div id="repromptDialog">
    <button on="tap:siteConsent.prompt">üç™</button>
  </div>
</amp-consent>

{% if site.custom_scripts.gtag %}
<!-- Google Tag Manager -->
<script>
  function analytics() {
    localStorage.setItem("analytics", true);
    (function (w, d, s, l, i) {
      w[l] = w[l] || [];
      w[l].push({
        'gtm.start':
                new Date().getTime(), event: 'gtm.js'
      });
      var f = d.getElementsByTagName(s)[0],
              j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : '';
      j.async = true;
      j.src =
              'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
      f.parentNode.insertBefore(j, f);
    })(window, document, 'script', 'dataLayer', '{{ site.custom_scripts.gtag }}');
  }

  if (JSON.parse(localStorage.getItem("analytics"))) {
    analytics()
  }

  let marketing = false;

  function updateValue(e) {
    marketing = e.target.checked;
  }

  function consentSelected() {
    if (marketing) {
      analytics();
    } else {
      localStorage.setItem("analytics", false);
    }
  }

  document.getElementById('consent-marketing').addEventListener('change', updateValue);
  document.getElementById('consent-all').addEventListener('click', analytics);
  document.getElementById('consent-selected').addEventListener('click', consentSelected);

</script>

<amp-script width="0" height="0" script="hello-world">
</amp-script>

<script id="hello-world" type="text/plain" target="amp-script">
  localStorage.setItem("analytics", true)
</script>

<!-- End Google Tag Manager -->
{% endif %}

{% endif %}
